<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MLB Prediction Tracker</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary: #1a73e8;
            --primary-dark: #0d47a1;
            --success: #4caf50;
            --danger: #f44336;
            --warning: #ff9800;
            --light: #f5f5f5;
            --dark: #333;
            --gray: #e0e0e0;
            --border: #ddd;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f8f9fa;
            color: #333;
            height: 100vh;
            overflow: hidden;
        }
        
        .container {
            display: flex;
            flex-direction: column;
            height: 100vh;
        }
        
        header {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            z-index: 10;
        }
        
        h1 {
            font-size: 1.8rem;
            font-weight: 600;
        }
        
        .view-toggle {
            display: flex;
            gap: 10px;
        }
        
        button {
            background-color: white;
            color: var(--primary);
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s ease;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        button:hover {
            background-color: var(--light);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }
        
        button:active {
            transform: translateY(0);
        }
        
        .dashboard-btn {
            background-color: var(--warning);
            color: white;
        }
        
        .dashboard-btn:hover {
            background-color: #e68a00;
        }
        
        .main-view, .dashboard-view {
            display: flex;
            flex-direction: column;
            height: calc(100vh - 70px);
        }
        
        .dashboard-view {
            display: none;
            padding: 20px;
        }
        
        .section {
            padding: 20px;
            background-color: white;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            border-radius: 8px;
            margin: 10px;
        }
        
        .section-title {
            font-size: 1.3rem;
            margin-bottom: 15px;
            color: var(--primary-dark);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .section-title i {
            font-size: 1.5rem;
        }
        
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .form-group {
            display: flex;
            flex-direction: column;
        }
        
        label {
            font-weight: 600;
            margin-bottom: 5px;
            color: #555;
        }
        
        select, input {
            padding: 12px;
            border: 1px solid var(--border);
            border-radius: 4px;
            font-size: 1rem;
        }
        
        select:focus, input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 2px rgba(26, 115, 232, 0.2);
        }
        
        .radio-group {
            display: flex;
            gap: 20px;
            margin-top: 5px;
        }
        
        .radio-option {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .submit-btn {
            background-color: var(--success);
            color: white;
            padding: 12px 24px;
            font-size: 1.1rem;
            font-weight: 600;
            border-radius: 4px;
            cursor: pointer;
            border: none;
            transition: all 0.2s ease;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        .submit-btn:hover {
            background-color: #3d8b40;
            transform: translateY(-2px);
            box-shadow: 0 6px 8px rgba(0,0,0,0.15);
        }
        
        .predictions-container {
            overflow-y: auto;
            flex: 1;
            padding: 10px;
        }
        
        .predictions-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 15px;
        }
        
        .prediction-card {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            padding: 15px;
            transition: all 0.3s ease;
            border-left: 4px solid var(--gray);
        }
        
        .prediction-card.pending {
            border-left-color: var(--gray);
        }
        
        .prediction-card.win {
            border-left-color: var(--success);
            background-color: #e8f5e9;
        }
        
        .prediction-card.loss {
            border-left-color: var(--danger);
            background-color: #ffebee;
        }
        
        .matchup {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .vs {
            font-size: 0.9rem;
            color: #777;
            font-weight: normal;
        }
        
        .prediction-details {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .detail-item {
            display: flex;
            flex-direction: column;
        }
        
        .detail-label {
            font-size: 0.85rem;
            color: #777;
        }
        
        .detail-value {
            font-weight: 600;
        }
        
        .result-actions {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }
        
        .result-btn {
            flex: 1;
            padding: 8px;
            font-weight: 600;
        }
        
        .win-btn {
            background-color: var(--success);
            color: white;
        }
        
        .loss-btn {
            background-color: var(--danger);
            color: white;
        }
        
        .disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        
        .disabled:hover {
            transform: none;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .dashboard-content {
            display: flex;
            flex-direction: column;
            height: 100%;
        }
        
        .pnl-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .summary-card {
            background-color: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            text-align: center;
        }
        
        .summary-value {
            font-size: 2rem;
            font-weight: 700;
            margin: 10px 0;
        }
        
        .positive {
            color: var(--success);
        }
        
        .negative {
            color: var(--danger);
        }
        
        .chart-container {
            flex: 1;
            background-color: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        
        .no-predictions {
            text-align: center;
            padding: 40px;
            color: #777;
        }
        
        .no-predictions i {
            font-size: 3rem;
            margin-bottom: 15px;
            color: var(--gray);
        }
        
        @media (max-width: 768px) {
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .predictions-grid {
                grid-template-columns: 1fr;
            }
            
            .prediction-details {
                grid-template-columns: 1fr;
            }
            
            .pnl-summary {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>⚾ MLB Prediction Tracker</h1>
            <div class="view-toggle">
                <button id="dashboardToggle" class="dashboard-btn">View PNL Dashboard</button>
            </div>
        </header>
        
        <div class="main-view" id="mainView">
            <div class="section">
                <h2 class="section-title">Add New Prediction</h2>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="team1">Home Team</label>
                        <select id="team1"></select>
                    </div>
                    
                    <div class="form-group">
                        <label for="team2">Away Team</label>
                        <select id="team2"></select>
                    </div>
                    
                    <div class="form-group">
                        <label>Predicted Winner</label>
                        <div class="radio-group">
                            <div class="radio-option">
                                <input type="radio" id="winner1" name="winner" value="team1">
                                <label for="winner1" id="winner1Label">Home Team</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="winner2" name="winner" value="team2">
                                <label for="winner2" id="winner2Label">Away Team</label>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>Line Type</label>
                        <div class="radio-group">
                            <div class="radio-option">
                                <input type="radio" id="moneyline" name="line" value="moneyline" checked>
                                <label for="moneyline">Moneyline</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="spread" name="line" value="spread">
                                <label for="spread">-1.5</label>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="odds">Decimal Odds</label>
                        <input type="number" id="odds" step="0.01" min="1.01" placeholder="e.g., 1.85">
                    </div>
                </div>
                
                <button id="addPrediction" class="submit-btn">Add Prediction</button>
            </div>
            
            <div class="section" style="flex: 1; display: flex; flex-direction: column;">
                <h2 class="section-title">Your Predictions</h2>
                <div class="predictions-container">
                    <div class="predictions-grid" id="predictionsGrid">
                        <!-- Predictions will be added here dynamically -->
                    </div>
                </div>
            </div>
        </div>
        
        <div class="dashboard-view" id="dashboardView">
            <div class="dashboard-content">
                <div class="pnl-summary">
                    <div class="summary-card">
                        <h3>Total Bets</h3>
                        <div class="summary-value" id="totalBets">0</div>
                    </div>
                    <div class="summary-card">
                        <h3>Win Rate</h3>
                        <div class="summary-value" id="winRate">0%</div>
                    </div>
                    <div class="summary-card">
                        <h3>Portfolio Growth</h3>
                        <div class="summary-value" id="portfolioGrowth">0%</div>
                    </div>
                </div>
                
                <div class="chart-container">
                    <canvas id="pnlChart"></canvas>
                </div>
                
                <button id="backToMain" style="align-self: center; margin-top: 20px;">Back to Predictions</button>
            </div>
        </div>
    </div>

    <script>
        // localStorage.removeItem('mlbPredictions'); // Uncomment to reset all predictions
        
        // MLB Teams data
        const mlbTeams = [
            "Arizona Diamondbacks", "Atlanta Braves", "Baltimore Orioles", "Boston Red Sox",
            "Chicago Cubs", "Chicago White Sox", "Cincinnati Reds", "Cleveland Guardians",
            "Colorado Rockies", "Detroit Tigers", "Houston Astros", "Kansas City Royals",
            "Los Angeles Angels", "Los Angeles Dodgers", "Miami Marlins", "Milwaukee Brewers",
            "Minnesota Twins", "New York Mets", "New York Yankees", "Oakland Athletics",
            "Philadelphia Phillies", "Pittsburgh Pirates", "San Diego Padres", "San Francisco Giants",
            "Seattle Mariners", "St. Louis Cardinals", "Tampa Bay Rays", "Texas Rangers",
            "Toronto Blue Jays", "Washington Nationals"
        ];
        
        // DOM Elements
        const team1Select = document.getElementById('team1');
        const team2Select = document.getElementById('team2');
        const winner1Label = document.getElementById('winner1Label');
        const winner2Label = document.getElementById('winner2Label');
        const addPredictionBtn = document.getElementById('addPrediction');
        const predictionsGrid = document.getElementById('predictionsGrid');
        const dashboardToggle = document.getElementById('dashboardToggle');
        const dashboardView = document.getElementById('dashboardView');
        const mainView = document.getElementById('mainView');
        const backToMainBtn = document.getElementById('backToMain');
        const totalBetsEl = document.getElementById('totalBets');
        const winRateEl = document.getElementById('winRate');
        const portfolioGrowthEl = document.getElementById('portfolioGrowth');
        const pnlChartCtx = document.getElementById('pnlChart').getContext('2d');
        
        // Initialize Chart.js
        let pnlChart = null;
        
        // Format date as "May 5 2025"
        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('en-US', { 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            });
        }
        
        // Populate team dropdowns
        function populateTeams() {
            team1Select.innerHTML = '';
            team2Select.innerHTML = '';
            
            mlbTeams.forEach(team => {
                const option1 = document.createElement('option');
                option1.value = team;
                option1.textContent = team;
                team1Select.appendChild(option1);
                
                const option2 = document.createElement('option');
                option2.value = team;
                option2.textContent = team;
                team2Select.appendChild(option2);
            });
            
            // Set default teams
            team1Select.value = "New York Yankees";
            team2Select.value = "Boston Red Sox";
            updateWinnerLabels();
        }
        
        // Update winner labels based on selected teams
        function updateWinnerLabels() {
            winner1Label.textContent = team1Select.value || "Home Team";
            winner2Label.textContent = team2Select.value || "Away Team";
        }
        
        // Load predictions from localStorage
        function loadPredictions() {
            const predictions = JSON.parse(localStorage.getItem('mlbPredictions')) || [];
            renderPredictions(predictions);
        }
        
        // Save predictions to localStorage
        function savePredictions(predictions) {
            localStorage.setItem('mlbPredictions', JSON.stringify(predictions));
        }
        
        // Add new prediction
        function addPrediction() {
            // Get form values
            const team1 = team1Select.value;
            const team2 = team2Select.value;
            const winner = document.querySelector('input[name="winner"]:checked');
            const line = document.querySelector('input[name="line"]:checked');
            const odds = parseFloat(document.getElementById('odds').value);
            
            // Validation
            if (!team1 || !team2 || !winner || !line || !odds || odds < 1.01) {
                alert('Please fill all fields correctly');
                return;
            }
            
            if (team1 === team2) {
                alert('Please select different teams');
                return;
            }
            
            // Create prediction object with date
            const prediction = {
                id: Date.now(),
                team1,
                team2,
                winner: winner.value,
                line: line.value,
                odds,
                result: null, // pending
                timestamp: new Date().toISOString(),
                date: new Date().toISOString().split('T')[0] // YYYY-MM-DD format
            };
            
            // Get existing predictions
            const predictions = JSON.parse(localStorage.getItem('mlbPredictions')) || [];
            
            // Add new prediction
            predictions.unshift(prediction);
            
            // Save to localStorage
            savePredictions(predictions);
            
            // Render predictions
            renderPredictions(predictions);
            
            // Reset form
            document.getElementById('odds').value = '';
            document.querySelector('input[name="winner"][value="team1"]').checked = true;
            document.querySelector('input[name="line"][value="moneyline"]').checked = true;
            
            // Show success feedback
            addPredictionBtn.textContent = 'Prediction Added!';
            setTimeout(() => {
                addPredictionBtn.textContent = 'Add Prediction';
            }, 1500);
        }
        
        // Update prediction result
        function updatePredictionResult(id, result) {
            const predictions = JSON.parse(localStorage.getItem('mlbPredictions')) || [];
            const predictionIndex = predictions.findIndex(p => p.id === id);
            
            if (predictionIndex !== -1) {
                predictions[predictionIndex].result = result;
                savePredictions(predictions);
                renderPredictions(predictions);
            }
        }
        
        // Render predictions
        function renderPredictions(predictions) {
            predictionsGrid.innerHTML = '';
            
            if (predictions.length === 0) {
                predictionsGrid.innerHTML = `
                    <div class="no-predictions">
                        <div>⚾</div>
                        <h3>No predictions yet</h3>
                        <p>Add your first MLB prediction to get started</p>
                    </div>
                `;
                return;
            }
            
            predictions.forEach(prediction => {
                const predictedWinner = prediction.winner === 'team1' ? prediction.team1 : prediction.team2;
                const resultClass = prediction.result ? (prediction.result === 'win' ? 'win' : 'loss') : 'pending';
                const formattedDate = formatDate(prediction.date);
                
                const card = document.createElement('div');
                card.className = `prediction-card ${resultClass}`;
                card.innerHTML = `
                    <div class="matchup">
                        <span>${prediction.team1}</span>
                        <span class="vs">vs</span>
                        <span>${prediction.team2}</span>
                    </div>
                    <div class="prediction-details">
                        <div class="detail-item">
                            <span class="detail-label">Predicted Winner</span>
                            <span class="detail-value">${predictedWinner}</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Line Type</span>
                            <span class="detail-value">${prediction.line === 'moneyline' ? 'Moneyline' : '-1.5'}</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Odds</span>
                            <span class="detail-value">${prediction.odds.toFixed(2)}</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Date</span>
                            <span class="detail-value">${formattedDate}</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Status</span>
                            <span class="detail-value">${prediction.result ? (prediction.result === 'win' ? 'Win' : 'Loss') : 'Pending'}</span>
                        </div>
                    </div>
                    <div class="result-actions">
                        <button class="result-btn win-btn ${prediction.result ? 'disabled' : ''}" 
                                onclick="updatePredictionResult(${prediction.id}, 'win')"
                                ${prediction.result ? 'disabled' : ''}>Win</button>
                        <button class="result-btn loss-btn ${prediction.result ? 'disabled' : ''}" 
                                onclick="updatePredictionResult(${prediction.id}, 'loss')"
                                ${prediction.result ? 'disabled' : ''}>Loss</button>
                    </div>
                `;
                
                predictionsGrid.appendChild(card);
            });
        }
        
        // Calculate PNL as portfolio growth percentage using proper odds calculation
        // Calculate PNL as portfolio growth percentage using proper odds calculation
// Calculate PNL as portfolio growth percentage using proper odds calculation
function calculatePNL() {
    const predictions = JSON.parse(localStorage.getItem('mlbPredictions')) || [];
    // Filter out pending predictions
    const resolvedPredictions = predictions.filter(p => p.result !== null);
    // Sort by date
    resolvedPredictions.sort((a, b) => new Date(a.date) - new Date(b.date));
    // Calculate stats
    const totalBets = resolvedPredictions.length;
    const wins = resolvedPredictions.filter(p => p.result === 'win').length;
    const winRate = totalBets > 0 ? Math.round((wins / totalBets) * 100) : 0;
    // Calculate portfolio growth percentage using proper odds calculation
    // Starting with 100 units, 1 unit per bet
    let totalUnits = 100; // Starting portfolio
    const growthData = [];
    const labels = [];
    
    // Group predictions by date to handle multiple bets on same day
    const dateGroups = {};
    resolvedPredictions.forEach(prediction => {
        if (!dateGroups[prediction.date]) {
            dateGroups[prediction.date] = [];
        }
        dateGroups[prediction.date].push(prediction);
    });
    
    // Process each date group
    const sortedDates = Object.keys(dateGroups).sort((a, b) => new Date(a) - new Date(b));
    sortedDates.forEach(date => {
        const predictionsForDate = dateGroups[date];
        // Process all bets for this date sequentially
        predictionsForDate.forEach(prediction => {
            if (prediction.result === 'win') {
                // Win: gain (odds - 1) units
                totalUnits += (prediction.odds - 1);
            } else {
                // Loss: lose 1 unit
                totalUnits -= 1;
            }
        });
        // Growth percentage from starting 100 units
        const growthPercentage = ((totalUnits - 100) / 100) * 100;
        growthData.push(growthPercentage);
        labels.push(formatDate(date));
    });
    
    // Calculate portfolio growth percentage 
    const portfolioGrowth = totalBets > 0 ? (((totalUnits - 100)) * 100).toFixed(2) : '0.00';
    // Update summary
    totalBetsEl.textContent = totalBets;
    winRateEl.textContent = `${winRate}%`;
    portfolioGrowthEl.textContent = `${portfolioGrowth}%`;
    portfolioGrowthEl.className = portfolioGrowth >= 0 ? 'summary-value positive' : 'summary-value negative';
    
    // Update chart
    if (pnlChart) {
        pnlChart.destroy();
    }
    pnlChart = new Chart(pnlChartCtx, {
        type: 'line',
        data: {
            labels: labels,
            datasets: [{
                label: 'Portfolio Growth (%)',
                data: growthData,
                borderColor: portfolioGrowth >= 0 ? '#4caf50' : '#f44336',
                backgroundColor: portfolioGrowth >= 0 ? 'rgba(76, 175, 80, 0.1)' : 'rgba(244, 67, 54, 0.1)',
                borderWidth: 3,
                pointRadius: 4,
                pointBackgroundColor: portfolioGrowth >= 0 ? '#4caf50' : '#f44336',
                fill: true,
                tension: 0.3
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    display: false
                },
                tooltip: {
                    mode: 'index',
                    intersect: false,
                    callbacks: {
                        label: function(context) {
                            return `Growth: ${context.parsed.y.toFixed(2)}%`;
                        }
                    }
                }
            },
            scales: {
                y: {
                    beginAtZero: false,
                    grid: {
                        color: 'rgba(0, 0, 0, 0.05)'
                    },
                    title: {
                        display: true,
                        text: 'Portfolio Growth (%)'
                    }
                },
                x: {
                    grid: {
                        display: false
                    },
                    title: {
                        display: true,
                        text: 'Date'
                    }
                }
            }
        }
    });
}
        
        // Toggle views
        function toggleView() {
            if (mainView.style.display === 'none') {
                mainView.style.display = 'flex';
                dashboardView.style.display = 'none';
                dashboardToggle.textContent = 'View PNL Dashboard';
            } else {
                mainView.style.display = 'none';
                dashboardView.style.display = 'flex';
                dashboardToggle.textContent = 'Back to Predictions';
                calculatePNL();
            }
        }
        
        // Event Listeners
        team1Select.addEventListener('change', updateWinnerLabels);
        team2Select.addEventListener('change', updateWinnerLabels);
        addPredictionBtn.addEventListener('click', addPrediction);
        dashboardToggle.addEventListener('click', toggleView);
        backToMainBtn.addEventListener('click', toggleView);
        
        // Initialize
        populateTeams();
        loadPredictions();
    </script>
</body>
</html>